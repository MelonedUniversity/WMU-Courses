# Church Encoding

邱奇编码

## 概要

邱奇编码是将数据和运算符嵌入λ表达式的一种方式，它通过把数据和运算符以λ表达式的形式表示出来，消除了对符号系统中基本项的需要。

## 问题引入

通过阅读 $Y$ 组合子那一章节，我们了解了如何将在不为λ表达式具名$^{*1}$的前提下表示递归，让我们回顾那个阶乘函数的例子：

$fac=Y\ (λx.λf.(if\ x > 0\ then\ x*f(x-1)\ else\ 1))$

其中，$Y$ 是一个高阶函数，如果展开，将变成这样：

$fac=(λf.((λx.f(x\ x))\ (λx.f(x\ x))))\ (λx.λf.(if\ x > 0\ then\ x*f(x-1)\ else\ 1))$

我们使用 $Y$ 组合子很好地解决了λ演算中递归的具名问题。  
但如果你是一个追求完美的人，相信你会有所质疑：这个 $if$ 表达式不也是有名字的么，为什么不把它也给去除掉？  
如果你更加严苛：为什么不把大于号和减号也给去掉？  
更进一步地：数字也是具名的！必须要把数字去掉！

邱奇编码就是为此而生的。

## 邱奇数及简单运算

邱奇数是邱奇编码的一部分，它采用一系列函数来表示数字，这使得数字的名称不再是必要的，像这样：

$0=λf.λx.\ x$  
$1=λf.λx.\ f\ x$  
$2=λf.λx.\ f\ (f\ x)$  
$3=λf.λx.\ f\ (f\ (f\ x))$  
$...$  
$n=λf.λx.\ f^{○n}\ x$

你会质疑：我的数字变成了一大堆函数，这样还怎么算数？  

显然计算这样奇怪的数字需要更加奇怪的运算符来实现，为此，建立于邱奇数上的运算符表示为作用于邱奇数的一系列函数，下面是一些简单运算符的邱奇编码表达（并不局限于此！$^{*2}$）：

加法 `m+n`：$plus\quad ≡ λm.λn.λf.λx.\ m\ f\ (n\ f\ x)$  
乘法 `m*n`：$mult\ \ \ ≡ λm.λn.λf.\ n\ (m\ f)$  
指数 `m^n`：$exp\quad\ ≡ λm.λn.\ n\ m$  
前驱 `n--`：$pred\quad ≡ λn.λf.λx.\ n\ (λg.λh.\ h\ (g\ f))\ (λu.\ x)\ (λu.\ u)$  
减法 `m-n`：$minus\ ≡ λm.λn.\ n\ pred\ m$

其中，前驱函数 $pred$ 用于计算一个数的前一个数，减法函数基于 $pred$ 实现$^{*3}$。

举个栗子，让我们计算 `1+2` ：

$\quad1+2$  
$=plus\ 1\ 2$  
$=(λm.λn.λf.λx.\ m\ f\ (n\ f\ x))\ 1\ 2$  
$=(λm.λn.λf.λx.\ m\ f\ (n\ f\ x))\ (λf.λx.\ f\ x)\ (λf.λx.\ f\ (f\ x))$  
$=λf.λx.\ (λf.λx.\ f\ x)\ f\ ((λf.λx.\ f\ (f\ x))\ f\ x)$  
$=λf.λx.\ (λf.λx.\ f\ x)\ f\ (f\ (f\ x))$  
$=λf.λx.\ f\ (f\ (f\ x))$  
$=3$

呐呐呐，是不是很神奇？

## 布尔值和条件分支

在邱奇编码下，布尔值被形式化为：

$true\ \ ≡λa.λb.\ a$  
$false≡λa.λb.\ b$

注意到 $a$ 和 $b$ 其实相当于两个计算分支，所以可以如下构造 $if$：

$if=λp.λa.λb.\ p\ a\ b$

那么 $if\ true\ then\ 1\ else\ 0$ 就可以表示为 $(λp.λa.λb.\ p\ a\ b)\ true\ 1\ 0$，对其进行 $β$ 归约可得：

$\quad(λp.λa.λb.\ p\ a\ b)\ (λa.λb.\ a)\ (λf.λx.\ f\ x)\ (λf.λx.\ x)$  
$=(λa.λb.\ a)\ (λf.λx.\ f\ x)\ (λf.λx.\ x)$  
$=(λf.λx.\ f\ x)$  
$=1$

awesome.

## 改写阶乘函数

要想改写我们的阶乘函数，以上的要素还不够，需额外引入以下函数：  

逻辑非 `!n`：$not=λp.λa.λb.\ p\ b\ a$  
判零 `n=0`：$IsZero=λn.\ n\ (λx.\ false)\ true$  
小于等于 `m≤n`：$LEQ=λm.λn.\ IsZero\ (minus\ m\ n)$

于是我们的阶乘函数就可以被完全函数化了：

$fac=Y\ (λx.λf.(if\ (not\ (LEQ\ x\ 0))\ (mult\ x\ f(x-1))\ 1))$

完全展开可得：

$fac=(λf.((λx.f(x\ x))\ (λx.f(x\ x))))\ (λx.λf.((λp.λa.λb.\ p\ a\ b)\ ((λp.λa.λb.\ p\ b\ a)\ \\((λm.λn.\ (λn.\ n\ (λx.\ false)\ (λa.λb.\ a))\ ((λm.λn.\ n\ (λn.λf.λx.\ n\ (λg.λh.\ h\ (g\ f))\ \\(λu.\ x)\ (λu.\ u))\ m)\ m\ n))\ x\ (λf.λx.\ x)))\ ((λm.λn.λf.\ n\ (m\ f))\ x\ f((λm.λn.\ n\ \\(λn.λf.λx.\ n\ (λg.λh.\ h\ (g\ f))\ (λu.\ x)\ (λu.\ u))\ m)\ x\ (λf.λx.\ f\ x)))\ (λf.λx.\ f\ x)))$

太神奇了，这居然完全不可读（逃

## Playground

尝试计算 `1+1` （使用邱奇编码！）

---

### 注解

1. 具名，即给λ表达式命名，如：$miao=λx.x+1$  
2. 除法函式的表达较为复杂，不列。
3. 在邱奇编码中，$pred\ 0=0$，$m<n→m-n=0$